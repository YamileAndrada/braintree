
<script src="https://js.braintreegateway.com/v2/braintree.js"></script>
<script src="https://js.braintreegateway.com/web/dropin/1.3.1/js/dropin.min.js"></script>

<script>
var clientToken = "<%= Braintree::ClientToken.generate( :customer_id => current_user.customer_id) %>";
/*
braintree.setup(clientToken, "dropin", {
  container: "payment-form",
  options: {
      submit_for_settlement: true
  },
  locale: 'es_ES',
  paypal: {
    singleUse: true,
    currency: 'USD',
    locale: 'es_ES',
    amount: 10.00
  },
  dataCollector: {
    paypal: true  // Enables fraud prevention
  },
  custom: {id: "payment-form"},
  onError :function(obj){
    alert('onError');
    console.log(JSON.stringify(obj));
  }
});

:options => {  :fail_on_duplicate_payment_method => true }
https://js.braintreegateway.com/v2/braintree.js
https://js.braintreegateway.com/web/dropin/1.4.0/js/dropin.min.js
https://js.braintreegateway.com/web/3.19.1/js/client.min.js
*/
  braintree.dropin.create({
      authorization: clientToken,
      selector: '#payment-form',
      locale: 'es_ES', // esto deberia ser dinamico
      paymentOptionPriority: ['paypal', 'paypalCredit', 'card'],
       paypal: {
         flow: 'vault',
         amount: '23.45',
         currency: 'USD',
         style: {
            size: 'medium',
            color: 'gold',
            shape: 'pill',
            label: 'Subscribe Now'
        }
       },
       paypalCredit: {
         flow: 'vault',
         amount: '23.45',
         currency: 'USD'
       }
     }, function (createErr, instance) {
        var form = document.querySelector('#myform');
        form.addEventListener('submit', function (event) {
          event.preventDefault();
          instance.requestPaymentMethod(function (err, payload) {
            if (err) {
              console.log('Error', err);
              return;
            }
            // Add the nonce to the form and submit
            document.querySelector('#payment_method_nonce').value = payload.nonce;
            form.submit();
          });
        });
  });

</script>

<div class="container">
<h1>Subscribe</h1>
<%= simple_form_for( @subscription , html: { class: 'well', id: 'myform' })  do |f| %>
<div class="col-sm-6 col-sm-offset-1">
  <div id="payment-form">
  </div>
  <%= f.hidden_field :payment_method_token, id: "payment_method_nonce" %>
   <%= f.button :submit, "Subscribe Now", :method => :post, data: { "disable-with": "..." }, id:"submit-button",
         "data-toggle" => "tooltip", class: "btn btn-success" %>
</div>
<% end %>
</div>
